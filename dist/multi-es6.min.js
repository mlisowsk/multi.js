/*! multi.js 13-02-2024 */

var multi=function(){var e=function(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(e,!1,!0),t.dispatchEvent(n)},t=function(e,t){var n=t.limit;if(n>-1){for(var a=0,l=0;l<e.options.length;l++)e.options[l].selected&&a++;if(a===n){this.disabled_limit=!0,"function"==typeof t.limit_reached&&t.limit_reached();for(l=0;l<e.options.length;l++){(i=e.options[l]).selected||i.setAttribute("disabled",!0)}}else if(this.disabled_limit){for(l=0;l<e.options.length;l++){var i;"false"===(i=e.options[l]).getAttribute("data-origin-disabled")&&i.removeAttribute("disabled")}this.disabled_limit=!1}}},n=function(n,a,l){var i=n.options[a.target.getAttribute("multi-index")];i.disabled||(i.selected=!i.selected,t(n,l),e("change",n))},a=function(e,t){if(e.wrapper.selected.innerHTML="",e.wrapper.non_selected.innerHTML="",t.non_selected_header&&t.selected_header){var n=document.createElement("div"),a=document.createElement("div");n.className="header",a.className="header",n.innerText=t.non_selected_header,a.innerText=t.selected_header,e.wrapper.non_selected.appendChild(n),e.wrapper.selected.appendChild(a)}if(e.wrapper.search)var l=e.wrapper.search.value;var i=null,r=null;console.log("data-selected-order="+e.getAttribute("data-selected-order"));try{var d=JSON.parse(e.getAttribute("data-selected-order"))}catch(e){d=[]}for(var o,s,c=[],u=0;u<e.options.length;u++){var p=e.options[u],m=p.value,h=p.textContent||p.innerText,b=document.createElement("a");b.tabIndex=0,b.className="item",b.innerText=h,b.setAttribute("role","button"),b.setAttribute("data-value",m),b.setAttribute("multi-index",u),p.disabled&&(b.className+=" disabled");var v="true"===p.getAttribute("data-multi-hilight");if(p.selected){b.className+=" selected";var g=b.cloneNode(!0);v&&(g.className+=" hilight"),c.push(g)}if(v&&(b.className+=" hilight"),"OPTGROUP"==p.parentNode.nodeName&&p.parentNode!=r){if(r=p.parentNode,(i=document.createElement("div")).className="item-group",p.parentNode.label){var _=document.createElement("span");_.innerHTML=p.parentNode.label,_.className="group-label",i.appendChild(_)}e.wrapper.non_selected.appendChild(i)}p.parentNode==e&&(i=null,r=null),(!l||l&&h.toLowerCase().indexOf(l.toLowerCase())>-1)&&(null!=i?i.appendChild(b):e.wrapper.non_selected.appendChild(b))}console.log("selected_elems.length="+c.length+" "+JSON.stringify(c));for(var f=0;f<d.length;f++)o=d[f],console.log("looking for val="+o+" "+typeof o),(s=c.find_option_by_value(o))>=0&&(console.log("find_option_by_value found! for val="+o+" idx="+s),e.wrapper.selected.appendChild(c[s]),c.splice(s,1));console.log("remaining selected_elems.length="+c.length+" "+JSON.stringify(c));for(f=0;f<c.length;f++)e.wrapper.selected.appendChild(c[f]),d.push(c[f].getAttribute("data-value"));if(console.log("final selected_order="+d),e.setAttribute("data-selected-order",JSON.stringify(d)),t.hide_empty_groups){var N=document.getElementsByClassName("item-group");for(u=0;u<N.length;u++)N[u].childElementCount<2&&(N[u].style.display="none")}};Array.prototype.find_option_by_value=function(e){return this.findIndex(function(t,n){return console.log("checking i="+n+" el.value="+t.getAttribute("data-value")+" vs "+e+" for "+JSON.stringify(t)),t.getAttribute("data-value")==e})};return function(l,i){if((i=void 0!==i?i:{}).enable_search=void 0===i.enable_search||i.enable_search,i.search_placeholder=void 0!==i.search_placeholder?i.search_placeholder:"Search...",i.non_selected_header=void 0!==i.non_selected_header?i.non_selected_header:null,i.selected_header=void 0!==i.selected_header?i.selected_header:null,i.limit=void 0!==i.limit?parseInt(i.limit):-1,isNaN(i.limit)&&(i.limit=-1),i.hide_empty_groups=void 0!==i.hide_empty_groups&&i.hide_empty_groups,i.selected_order=Array.isArray(i.selected_order)?i.selected_order:[],null==l.dataset.multijs&&"SELECT"==l.nodeName&&l.multiple){l.style.display="none",l.setAttribute("data-multijs",!0),l.setAttribute("data-selected-order",JSON.stringify(i.selected_order));var r=document.createElement("div");if(r.className="multi-wrapper",i.enable_search){var d=document.createElement("input");d.className="search-input",d.type="text",d.setAttribute("placeholder",i.search_placeholder),d.setAttribute("title",i.search_placeholder),d.addEventListener("input",function(){a(l,i)}),r.appendChild(d),r.search=d}var o=document.createElement("div");o.className="non-selected-wrapper";var s=document.createElement("div");s.className="selected-wrapper";var c=!1,u=null;if(r.addEventListener("dblclick",function(e){e.target.getAttribute("multi-index")&&(clearTimeout(u),c=!0,n(l,e,i))}),r.addEventListener("click",function(t){t.target.getAttribute("multi-index")&&(u=setTimeout(()=>{c||function(t,n,a){var l=t.options[n.target.getAttribute("multi-index")];if(!l.disabled){var i="true"===l.getAttribute("data-multi-hilight");l.setAttribute("data-multi-hilight",""+!i),e("change",t)}}(l,t),c=!1},250))}),r.addEventListener("keypress",function(e){var t=32===e.keyCode||13===e.keyCode;e.target.getAttribute("multi-index")&&t&&(e.preventDefault(),n(l,e,i))}),r.appendChild(o),r.appendChild(s),r.non_selected=o,r.selected=s,l.wrapper=r,l.parentNode.insertBefore(r,l.nextSibling),i.selected_updown){console.log("adding updown buttons");var p=document.createElement("div"),m=document.createElement("div"),h=document.createElement("div"),b=document.createElement("button"),v=document.createElement("button");p.className="wrapper-low",h.className="controls",m.className="controls",b.className="btn btn-up",v.className="btn btn-down",b.setAttribute("type","button"),v.setAttribute("type","button"),b.innerHTML=i.button_up_label?i.button_up_label:"↑",v.innerHTML=i.button_down_label?i.button_down_label:"↓",h.appendChild(b),h.appendChild(v),p.appendChild(m),p.appendChild(h),l.parentNode.insertBefore(p,r.nextSibling)}for(var g=0;g<l.options.length;g++){var _=l.options[g];_.setAttribute("data-origin-disabled",_.disabled)}t(l,i),a(l,i),l.addEventListener("change",function(){a(l,i)})}}}();"undefined"!=typeof jQuery&&function(e){e.fn.multi=function(t){return t=void 0!==t?t:{},this.each(function(){var n=e(this);multi(n.get(0),t)})}}(jQuery);export default multi;