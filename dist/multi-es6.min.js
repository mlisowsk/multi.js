/*! multi.js 17-02-2024 */

var multi=function(){var e=function(e,t){var n=t.limit;if(n>-1){for(var i=0,r=0;r<e.options.length;r++)e.options[r].selected&&i++;if(i===n){this.disabled_limit=!0,"function"==typeof t.limit_reached&&t.limit_reached();for(r=0;r<e.options.length;r++){(a=e.options[r]).selected||a.setAttribute("disabled",!0)}}else if(this.disabled_limit){for(r=0;r<e.options.length;r++){var a;"false"===(a=e.options[r]).getAttribute("data-origin-disabled")&&a.removeAttribute("disabled")}this.disabled_limit=!1}}},t=function(t,n,i){var r,a,l,s=t.options[n.target.getAttribute("multi-index")];s.disabled||(s.selected=!s.selected,e(t,i),r="change",a=t,(l=document.createEvent("HTMLEvents")).initEvent(r,!1,!0),a.dispatchEvent(l))},n=function(e,t){for(var n=e.wrapper.lists.selected.querySelectorAll(".item"),i=[],r=0;r<n.length;r++)i.push(n[r].getAttribute("data-value"));return i},i=function(e,t,n){e.setAttribute("data-selected-order",JSON.stringify(n))},r=function(e,t){if(e.wrapper.lists.selected.innerHTML="",e.wrapper.lists.non_selected.innerHTML="",t.non_selected_header&&t.selected_header){var n=document.createElement("div"),r=document.createElement("div");n.className="header",r.className="header",n.innerText=t.non_selected_header,r.innerText=t.selected_header,e.wrapper.lists.non_selected.appendChild(n),e.wrapper.lists.selected.appendChild(r)}if(e.wrapper.search)var a=e.wrapper.search.value;for(var l,s,d=null,o=null,c=function(e,t){try{return JSON.parse(e.getAttribute("data-selected-order"))}catch(e){return[]}}(e),p=[],u=e.getAttribute("data-multi-hilight"),h=0;h<e.options.length;h++){var m=e.options[h],v=m.value,b=m.textContent||m.innerText,f=document.createElement("a");if(f.tabIndex=0,f.className="item",f.innerText=b,f.setAttribute("role","button"),f.setAttribute("data-value",v),f.setAttribute("multi-index",h),m.disabled&&(f.className+=" disabled"),m.selected){f.className+=" selected";var _=f.cloneNode(!0);u==h&&(_.className+=" hilight"),p.push(_)}if("OPTGROUP"==m.parentNode.nodeName&&m.parentNode!=o){if(o=m.parentNode,(d=document.createElement("div")).className="item-group",m.parentNode.label){var g=document.createElement("span");g.innerHTML=m.parentNode.label,g.className="group-label",d.appendChild(g)}e.wrapper.lists.non_selected.appendChild(d)}m.parentNode==e&&(d=null,o=null),(!a||a&&b.toLowerCase().indexOf(a.toLowerCase())>-1)&&(null!=d?d.appendChild(f):e.wrapper.lists.non_selected.appendChild(f))}for(var N=0;N<c.length;N++)l=c[N],(s=p.find_option_by_value(l))>=0&&(e.wrapper.lists.selected.appendChild(p[s]),p.splice(s,1));for(N=0;N<p.length;N++)e.wrapper.lists.selected.appendChild(p[N]),c.push(p[N].getAttribute("data-value"));if(i(e,t,c),t.hide_empty_groups){var y=document.getElementsByClassName("item-group");for(h=0;h<y.length;h++)y[h].childElementCount<2&&(y[h].style.display="none")}};Array.prototype.find_option_by_value=function(e){for(var t=0;t<this.length;t++)if(this[t].getAttribute("data-value")==e)return t;return-1};return function(a,l){if((l=void 0!==l?l:{}).enable_search=void 0===l.enable_search||l.enable_search,l.search_placeholder=void 0!==l.search_placeholder?l.search_placeholder:"Search...",l.non_selected_header=void 0!==l.non_selected_header?l.non_selected_header:null,l.selected_header=void 0!==l.selected_header?l.selected_header:null,l.limit=void 0!==l.limit?parseInt(l.limit):-1,isNaN(l.limit)&&(l.limit=-1),l.hide_empty_groups=void 0!==l.hide_empty_groups&&l.hide_empty_groups,l.selected_order=Array.isArray(l.selected_order)?l.selected_order:[],null==a.dataset.multijs&&"SELECT"==a.nodeName&&a.multiple){a.style.display="none",a.setAttribute("data-multijs",!0),a.setAttribute("data-selected-order",JSON.stringify(l.selected_order));var s=document.createElement("div");if(s.className="multi-wrapper",l.enable_search){var d=document.createElement("input");d.className="search-input",d.type="text",d.setAttribute("placeholder",l.search_placeholder),d.setAttribute("title",l.search_placeholder),d.addEventListener("input",function(){r(a,l)}),s.appendChild(d),s.search=d}var o=document.createElement("div");o.className="multi-wraplists";var c=document.createElement("div");c.className="non-selected-wrapper";var p=document.createElement("div");if(p.className="selected-wrapper",s.addEventListener("keypress",function(e){var n=32===e.keyCode||13===e.keyCode;e.target.getAttribute("multi-index")&&n&&(e.preventDefault(),t(a,e,l))}),o.appendChild(c),o.appendChild(p),o.non_selected=c,o.selected=p,s.appendChild(o),s.lists=o,a.wrapper=s,a.parentNode.insertBefore(s,a.nextSibling),s.addEventListener("dblclick",function(e){e.target.getAttribute("multi-index")&&t(a,e,l)}),s.addEventListener("click",function(e){e.target.getAttribute("multi-index")&&s.lists.selected.contains(e.target)&&function(e,t,n){var i=t.target.getAttribute("multi-index"),r=e.options[i];if(!r.disabled&&r.selected){e.setAttribute("data-multi-hilight",""+i);var a=e.wrapper.lists.selected.querySelectorAll(".item");if(a)for(var l=0;l<a.length;l++)a[l].classList.remove("hilight");t.target.className+=" hilight"}}(a,e)}),l.selected_updown){var u=document.createElement("div"),h=document.createElement("div"),m=document.createElement("div"),v=document.createElement("button"),b=document.createElement("button");u.className="wrapper-low",m.className="controls",h.className="controls",v.className="btn btn-up",b.className="btn btn-down",v.setAttribute("type","button"),b.setAttribute("type","button"),v.innerHTML=l.button_up_label?l.button_up_label:"↑",b.innerHTML=l.button_down_label?l.button_down_label:"↓",m.appendChild(v),m.appendChild(b),u.appendChild(h),u.appendChild(m),a.parentNode.insertBefore(u,s.nextSibling),v.addEventListener("click",function(e){!function(e,t,r){for(var a=e.wrapper.lists.selected.querySelectorAll(".item"),l=1;l<a.length;l++){var s=a[l];s.classList.contains("hilight")&&e.wrapper.lists.selected.insertBefore(s,a[l-1])}var d=n(e,r);i(e,r,d)}(a,0,l)}),b.addEventListener("click",function(e){!function(e,t,r){for(var a=e.wrapper.lists.selected.querySelectorAll(".item"),l=0;l<a.length-1;l++){var s=a[l];s.classList.contains("hilight")&&e.wrapper.lists.selected.insertBefore(s,a[l+1].nextSibling)}var d=n(e,r);i(e,r,d)}(a,0,l)})}for(var f=0;f<a.options.length;f++){var _=a.options[f];_.setAttribute("data-origin-disabled",_.disabled)}e(a,l),r(a,l),a.addEventListener("change",function(){r(a,l)})}}}();"undefined"!=typeof jQuery&&function(e){e.fn.multi=function(t){return t=void 0!==t?t:{},this.each(function(){var n=e(this);multi(n.get(0),t)})}}(jQuery);export default multi;