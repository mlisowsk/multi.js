/*! multi.js 15-02-2024 */

var multi=function(){var e=function(e,t){var n=t.limit;if(n>-1){for(var r=0,a=0;a<e.options.length;a++)e.options[a].selected&&r++;if(r===n){this.disabled_limit=!0,"function"==typeof t.limit_reached&&t.limit_reached();for(a=0;a<e.options.length;a++){(i=e.options[a]).selected||i.setAttribute("disabled",!0)}}else if(this.disabled_limit){for(a=0;a<e.options.length;a++){var i;"false"===(i=e.options[a]).getAttribute("data-origin-disabled")&&i.removeAttribute("disabled")}this.disabled_limit=!1}}},t=function(t,n,r){var a,i,l,d=t.options[n.target.getAttribute("multi-index")];d.disabled||(d.selected=!d.selected,e(t,r),a="change",i=t,(l=document.createEvent("HTMLEvents")).initEvent(a,!1,!0),i.dispatchEvent(l))},n=function(e,t){for(var n=e.wrapper.selected.querySelectorAll(".item"),r=[],a=0;a<n.length;a++)r.push(n[a].getAttribute("data-value"));return r},r=function(e,t,n){e.setAttribute("data-selected-order",JSON.stringify(n))},a=function(e,t){if(e.wrapper.selected.innerHTML="",e.wrapper.non_selected.innerHTML="",t.non_selected_header&&t.selected_header){var n=document.createElement("div"),a=document.createElement("div");n.className="header",a.className="header",n.innerText=t.non_selected_header,a.innerText=t.selected_header,e.wrapper.non_selected.appendChild(n),e.wrapper.selected.appendChild(a)}if(e.wrapper.search)var i=e.wrapper.search.value;for(var l,d,s=null,o=null,c=function(e,t){try{return JSON.parse(e.getAttribute("data-selected-order"))}catch(e){return[]}}(e),u=[],p=e.getAttribute("data-multi-hilight"),h=0;h<e.options.length;h++){var m=e.options[h],v=m.value,b=m.textContent||m.innerText,f=document.createElement("a");if(f.tabIndex=0,f.className="item",f.innerText=b,f.setAttribute("role","button"),f.setAttribute("data-value",v),f.setAttribute("multi-index",h),m.disabled&&(f.className+=" disabled"),m.selected){f.className+=" selected";var _=f.cloneNode(!0);p==h&&(_.className+=" hilight"),u.push(_)}if("OPTGROUP"==m.parentNode.nodeName&&m.parentNode!=o){if(o=m.parentNode,(s=document.createElement("div")).className="item-group",m.parentNode.label){var g=document.createElement("span");g.innerHTML=m.parentNode.label,g.className="group-label",s.appendChild(g)}e.wrapper.non_selected.appendChild(s)}m.parentNode==e&&(s=null,o=null),(!i||i&&b.toLowerCase().indexOf(i.toLowerCase())>-1)&&(null!=s?s.appendChild(f):e.wrapper.non_selected.appendChild(f))}for(var N=0;N<c.length;N++)l=c[N],(d=u.find_option_by_value(l))>=0&&(e.wrapper.selected.appendChild(u[d]),u.splice(d,1));for(N=0;N<u.length;N++)e.wrapper.selected.appendChild(u[N]),c.push(u[N].getAttribute("data-value"));if(r(e,t,c),t.hide_empty_groups){var y=document.getElementsByClassName("item-group");for(h=0;h<y.length;h++)y[h].childElementCount<2&&(y[h].style.display="none")}};Array.prototype.find_option_by_value=function(e){for(var t=0;t<this.length;t++)if(this[t].getAttribute("data-value")==e)return t;return-1};return function(i,l){if((l=void 0!==l?l:{}).enable_search=void 0===l.enable_search||l.enable_search,l.search_placeholder=void 0!==l.search_placeholder?l.search_placeholder:"Search...",l.non_selected_header=void 0!==l.non_selected_header?l.non_selected_header:null,l.selected_header=void 0!==l.selected_header?l.selected_header:null,l.limit=void 0!==l.limit?parseInt(l.limit):-1,isNaN(l.limit)&&(l.limit=-1),l.hide_empty_groups=void 0!==l.hide_empty_groups&&l.hide_empty_groups,l.selected_order=Array.isArray(l.selected_order)?l.selected_order:[],null==i.dataset.multijs&&"SELECT"==i.nodeName&&i.multiple){i.style.display="none",i.setAttribute("data-multijs",!0),i.setAttribute("data-selected-order",JSON.stringify(l.selected_order));var d=document.createElement("div");if(d.className="multi-wrapper",l.enable_search){var s=document.createElement("input");s.className="search-input",s.type="text",s.setAttribute("placeholder",l.search_placeholder),s.setAttribute("title",l.search_placeholder),s.addEventListener("input",function(){a(i,l)}),d.appendChild(s),d.search=s}var o=document.createElement("div");o.className="non-selected-wrapper";var c=document.createElement("div");if(c.className="selected-wrapper",d.addEventListener("keypress",function(e){var n=32===e.keyCode||13===e.keyCode;e.target.getAttribute("multi-index")&&n&&(e.preventDefault(),t(i,e,l))}),d.appendChild(o),d.appendChild(c),d.non_selected=o,d.selected=c,i.wrapper=d,i.parentNode.insertBefore(d,i.nextSibling),d.addEventListener("dblclick",function(e){e.target.getAttribute("multi-index")&&t(i,e,l)}),d.addEventListener("click",function(e){e.target.getAttribute("multi-index")&&d.selected.contains(e.target)&&function(e,t,n){var r=t.target.getAttribute("multi-index"),a=e.options[r];if(!a.disabled&&a.selected){e.setAttribute("data-multi-hilight",""+r);var i=e.wrapper.selected.querySelectorAll(".item");if(i)for(var l=0;l<i.length;l++)i[l].classList.remove("hilight");t.target.className+=" hilight"}}(i,e)}),l.selected_updown){var u=document.createElement("div"),p=document.createElement("div"),h=document.createElement("div"),m=document.createElement("button"),v=document.createElement("button");u.className="wrapper-low",h.className="controls",p.className="controls",m.className="btn btn-up",v.className="btn btn-down",m.setAttribute("type","button"),v.setAttribute("type","button"),m.innerHTML=l.button_up_label?l.button_up_label:"↑",v.innerHTML=l.button_down_label?l.button_down_label:"↓",h.appendChild(m),h.appendChild(v),u.appendChild(p),u.appendChild(h),i.parentNode.insertBefore(u,d.nextSibling),m.addEventListener("click",function(e){!function(e,t,a){for(var i=e.wrapper.selected.querySelectorAll(".item"),l=1;l<i.length;l++){var d=i[l];d.classList.contains("hilight")&&i[l-1].before(d)}var s=n(e,a);r(e,a,s)}(i,0,l)}),v.addEventListener("click",function(e){!function(e,t,a){for(var i=e.wrapper.selected.querySelectorAll(".item"),l=0;l<i.length-1;l++){var d=i[l];d.classList.contains("hilight")&&i[l+1].after(d)}var s=n(e,a);r(e,a,s)}(i,0,l)})}for(var b=0;b<i.options.length;b++){var f=i.options[b];f.setAttribute("data-origin-disabled",f.disabled)}e(i,l),a(i,l),i.addEventListener("change",function(){a(i,l)})}}}();"undefined"!=typeof jQuery&&function(e){e.fn.multi=function(t){return t=void 0!==t?t:{},this.each(function(){var n=e(this);multi(n.get(0),t)})}}(jQuery);export default multi;