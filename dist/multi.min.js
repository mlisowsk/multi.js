/*! multi.js 18-02-2024 */

var multi=function(){var e=function(e,t){var r=t.limit;if(r>-1){for(var i=0,n=0;n<e.options.length;n++)e.options[n].selected&&i++;if(i===r){this.disabled_limit=!0,"function"==typeof t.limit_reached&&t.limit_reached();for(n=0;n<e.options.length;n++){(l=e.options[n]).selected||l.setAttribute("disabled",!0)}}else if(this.disabled_limit){for(n=0;n<e.options.length;n++){var l;"false"===(l=e.options[n]).getAttribute("data-origin-disabled")&&l.removeAttribute("disabled")}this.disabled_limit=!1}}},t=function(t,n,l){var a=t.options[n.target.getAttribute("multi-index")];if(!a.disabled){var s,d,o;a.selected=!a.selected,e(t,l),s="change",d=t,(o=document.createEvent("HTMLEvents")).initEvent(s,!1,!0),d.dispatchEvent(o);var c=r(t,l);i(t,l,c)}},r=function(e,t){for(var r=e.wrapper.lists.selected.querySelectorAll(".item"),i=[],n=0;n<r.length;n++)i.push(r[n].getAttribute("data-value"));return i},i=function(e,t,r){e.setAttribute("data-selected-order",JSON.stringify(r))},n=function(e,t){if(e.wrapper.lists.selected.innerHTML="",e.wrapper.lists.non_selected.innerHTML="",t.non_selected_header&&t.selected_header){var r=document.createElement("div"),n=document.createElement("div");r.className="header",n.className="header",r.innerText=t.non_selected_header,n.innerText=t.selected_header,e.wrapper.lists.non_selected.appendChild(r),e.wrapper.lists.selected.appendChild(n)}if(e.wrapper.search)var l=e.wrapper.search.value;for(var a,s,d=null,o=null,c=function(e,t){try{return JSON.parse(e.getAttribute("data-selected-order"))}catch(e){return[]}}(e),u=[],p=e.getAttribute("data-multi-hilight"),h=0;h<e.options.length;h++){var m=e.options[h],v=m.value,b=m.textContent||m.innerText,f=document.createElement("li");if(f.tabIndex=0,f.className="item",f.innerText=b,f.setAttribute("role","option"),f.setAttribute("data-value",v),f.setAttribute("multi-index",h),m.disabled&&(f.className+=" disabled"),m.selected){f.className+=" selected";var _=f.cloneNode(!0);p==h&&(_.className+=" hilight"),u.push(_)}if("OPTGROUP"==m.parentNode.nodeName&&m.parentNode!=o){if(o=m.parentNode,(d=document.createElement("div")).className="item-group",m.parentNode.label){var g=document.createElement("span");g.innerHTML=m.parentNode.label,g.className="group-label",d.appendChild(g)}e.wrapper.lists.non_selected.appendChild(d)}m.parentNode==e&&(d=null,o=null),(!l||l&&b.toLowerCase().indexOf(l.toLowerCase())>-1)&&(null!=d?d.appendChild(f):e.wrapper.lists.non_selected.appendChild(f))}for(var y=0;y<c.length;y++)a=c[y],(s=u.find_option_by_value(a))>=0&&(e.wrapper.lists.selected.appendChild(u[s]),u.splice(s,1));for(y=0;y<u.length;y++)e.wrapper.lists.selected.appendChild(u[y]),c.push(u[y].getAttribute("data-value"));if(i(e,t,c),t.hide_empty_groups){var N=document.getElementsByClassName("item-group");for(h=0;h<N.length;h++)N[h].childElementCount<2&&(N[h].style.display="none")}};Array.prototype.find_option_by_value=function(e){for(var t=0;t<this.length;t++)if(this[t].getAttribute("data-value")==e)return t;return-1};return function(l,a){if((a=void 0!==a?a:{}).enable_search=void 0===a.enable_search||a.enable_search,a.search_placeholder=void 0!==a.search_placeholder?a.search_placeholder:"Search...",a.non_selected_header=void 0!==a.non_selected_header?a.non_selected_header:null,a.selected_header=void 0!==a.selected_header?a.selected_header:null,a.limit=void 0!==a.limit?parseInt(a.limit):-1,isNaN(a.limit)&&(a.limit=-1),a.hide_empty_groups=void 0!==a.hide_empty_groups&&a.hide_empty_groups,a.selected_order=Array.isArray(a.selected_order)?a.selected_order:[],null==l.dataset.multijs&&"SELECT"==l.nodeName&&l.multiple){l.style.display="none",l.setAttribute("data-multijs",!0),l.setAttribute("data-selected-order",JSON.stringify(a.selected_order));var s=document.createElement("div");if(s.className="multi-wrapper",a.enable_search){var d=document.createElement("input");d.className="search-input",d.type="text",d.setAttribute("placeholder",a.search_placeholder),d.setAttribute("title",a.search_placeholder),d.addEventListener("input",function(){n(l,a)}),s.appendChild(d),s.search=d}var o=document.createElement("div");o.className="multi-wraplists";var c=document.createElement("ol");c.className="non-selected-wrapper",c.setAttribute("role","listbox");var u=document.createElement("ol");if(u.className="selected-wrapper",u.setAttribute("role","listbox"),s.addEventListener("keypress",function(e){var r=32===e.keyCode||13===e.keyCode;e.target.getAttribute("multi-index")&&r&&(e.preventDefault(),t(l,e,a))}),o.appendChild(c),o.appendChild(u),o.non_selected=c,o.selected=u,s.appendChild(o),s.lists=o,l.wrapper=s,l.parentNode.insertBefore(s,l.nextSibling),s.addEventListener("dblclick",function(e){e.target.getAttribute("multi-index")&&t(l,e,a)}),s.addEventListener("click",function(e){e.target.getAttribute("multi-index")&&s.lists.selected.contains(e.target)&&function(e,t,r){var i=t.target.getAttribute("multi-index"),n=e.options[i];if(!n.disabled&&n.selected){e.setAttribute("data-multi-hilight",""+i);var l=e.wrapper.lists.selected.querySelectorAll(".item");if(l)for(var a=0;a<l.length;a++)l[a].classList.remove("hilight");t.target.className+=" hilight"}}(l,e)}),a.selected_updown){var p=document.createElement("div"),h=document.createElement("div"),m=document.createElement("div"),v=document.createElement("button"),b=document.createElement("button");p.className="wrapper-low",m.className="controls",h.className="controls",v.className="btn btn-up",b.className="btn btn-down",v.setAttribute("type","button"),b.setAttribute("type","button"),v.innerHTML=a.button_up_label?a.button_up_label:"↑",b.innerHTML=a.button_down_label?a.button_down_label:"↓",m.appendChild(v),m.appendChild(b),p.appendChild(h),p.appendChild(m),s.appendChild(p),v.addEventListener("click",function(e){!function(e,t,n){for(var l=e.wrapper.lists.selected.querySelectorAll(".item"),a=1;a<l.length;a++){var s=l[a];s.classList.contains("hilight")&&e.wrapper.lists.selected.insertBefore(s,l[a-1])}var d=r(e,n);i(e,n,d)}(l,0,a)}),b.addEventListener("click",function(e){!function(e,t,n){for(var l=e.wrapper.lists.selected.querySelectorAll(".item"),a=0;a<l.length-1;a++){var s=l[a];s.classList.contains("hilight")&&e.wrapper.lists.selected.insertBefore(s,l[a+1].nextSibling)}var d=r(e,n);i(e,n,d)}(l,0,a)})}for(var f=0;f<l.options.length;f++){var _=l.options[f];_.setAttribute("data-origin-disabled",_.disabled)}e(l,a),n(l,a),l.addEventListener("change",function(){n(l,a)})}}}(),multi_get_selected_order=function(e){if(e)try{var t=e.getAttribute("data-selected-order");return t?JSON.parse(t):void 0}catch(e){return[]}};"undefined"!=typeof jQuery&&function(e){e.fn.multi=function(t){if("string"!=typeof t)return settings=void 0!==t?t:{},this.each(function(){var t=e(this);multi(t.get(0),settings)});if("multi_get_selected_order"===t){var r=e(this);if(r.length>1)throw"Method call only supported on a single jQuery object.";return multi_get_selected_order(r.get(0))}}}(jQuery);