/*! multi.js 17-02-2024 */

var multi=function(){var e=function(e,t){var r=t.limit;if(r>-1){for(var i=0,n=0;n<e.options.length;n++)e.options[n].selected&&i++;if(i===r){this.disabled_limit=!0,"function"==typeof t.limit_reached&&t.limit_reached();for(n=0;n<e.options.length;n++){(a=e.options[n]).selected||a.setAttribute("disabled",!0)}}else if(this.disabled_limit){for(n=0;n<e.options.length;n++){var a;"false"===(a=e.options[n]).getAttribute("data-origin-disabled")&&a.removeAttribute("disabled")}this.disabled_limit=!1}}},t=function(t,n,a){var l=t.options[n.target.getAttribute("multi-index")];if(!l.disabled){var s,d,o;l.selected=!l.selected,e(t,a),s="change",d=t,(o=document.createEvent("HTMLEvents")).initEvent(s,!1,!0),d.dispatchEvent(o);var c=r(t,a);i(t,a,c)}},r=function(e,t){for(var r=e.wrapper.lists.selected.querySelectorAll(".item"),i=[],n=0;n<r.length;n++)i.push(r[n].getAttribute("data-value"));return i},i=function(e,t,r){e.setAttribute("data-selected-order",JSON.stringify(r))},n=function(e,t){if(e.wrapper.lists.selected.innerHTML="",e.wrapper.lists.non_selected.innerHTML="",t.non_selected_header&&t.selected_header){var r=document.createElement("div"),n=document.createElement("div");r.className="header",n.className="header",r.innerText=t.non_selected_header,n.innerText=t.selected_header,e.wrapper.lists.non_selected.appendChild(r),e.wrapper.lists.selected.appendChild(n)}if(e.wrapper.search)var a=e.wrapper.search.value;for(var l,s,d=null,o=null,c=function(e,t){try{return JSON.parse(e.getAttribute("data-selected-order"))}catch(e){return[]}}(e),u=[],p=e.getAttribute("data-multi-hilight"),h=0;h<e.options.length;h++){var m=e.options[h],v=m.value,f=m.textContent||m.innerText,_=document.createElement("a");if(_.tabIndex=0,_.className="item",_.innerText=f,_.setAttribute("role","button"),_.setAttribute("data-value",v),_.setAttribute("multi-index",h),m.disabled&&(_.className+=" disabled"),m.selected){_.className+=" selected";var b=_.cloneNode(!0);p==h&&(b.className+=" hilight"),u.push(b)}if("OPTGROUP"==m.parentNode.nodeName&&m.parentNode!=o){if(o=m.parentNode,(d=document.createElement("div")).className="item-group",m.parentNode.label){var g=document.createElement("span");g.innerHTML=m.parentNode.label,g.className="group-label",d.appendChild(g)}e.wrapper.lists.non_selected.appendChild(d)}m.parentNode==e&&(d=null,o=null),(!a||a&&f.toLowerCase().indexOf(a.toLowerCase())>-1)&&(null!=d?d.appendChild(_):e.wrapper.lists.non_selected.appendChild(_))}for(var y=0;y<c.length;y++)l=c[y],(s=u.find_option_by_value(l))>=0&&(e.wrapper.lists.selected.appendChild(u[s]),u.splice(s,1));for(y=0;y<u.length;y++)e.wrapper.lists.selected.appendChild(u[y]),c.push(u[y].getAttribute("data-value"));if(i(e,t,c),t.hide_empty_groups){var N=document.getElementsByClassName("item-group");for(h=0;h<N.length;h++)N[h].childElementCount<2&&(N[h].style.display="none")}};Array.prototype.find_option_by_value=function(e){for(var t=0;t<this.length;t++)if(this[t].getAttribute("data-value")==e)return t;return-1};return function(a,l){if((l=void 0!==l?l:{}).enable_search=void 0===l.enable_search||l.enable_search,l.search_placeholder=void 0!==l.search_placeholder?l.search_placeholder:"Search...",l.non_selected_header=void 0!==l.non_selected_header?l.non_selected_header:null,l.selected_header=void 0!==l.selected_header?l.selected_header:null,l.limit=void 0!==l.limit?parseInt(l.limit):-1,isNaN(l.limit)&&(l.limit=-1),l.hide_empty_groups=void 0!==l.hide_empty_groups&&l.hide_empty_groups,l.selected_order=Array.isArray(l.selected_order)?l.selected_order:[],null==a.dataset.multijs&&"SELECT"==a.nodeName&&a.multiple){a.style.display="none",a.setAttribute("data-multijs",!0),a.setAttribute("data-selected-order",JSON.stringify(l.selected_order));var s=document.createElement("div");if(s.className="multi-wrapper",l.enable_search){var d=document.createElement("input");d.className="search-input",d.type="text",d.setAttribute("placeholder",l.search_placeholder),d.setAttribute("title",l.search_placeholder),d.addEventListener("input",function(){n(a,l)}),s.appendChild(d),s.search=d}var o=document.createElement("div");o.className="multi-wraplists";var c=document.createElement("div");c.className="non-selected-wrapper";var u=document.createElement("div");if(u.className="selected-wrapper",s.addEventListener("keypress",function(e){var r=32===e.keyCode||13===e.keyCode;e.target.getAttribute("multi-index")&&r&&(e.preventDefault(),t(a,e,l))}),o.appendChild(c),o.appendChild(u),o.non_selected=c,o.selected=u,s.appendChild(o),s.lists=o,a.wrapper=s,a.parentNode.insertBefore(s,a.nextSibling),s.addEventListener("dblclick",function(e){e.target.getAttribute("multi-index")&&t(a,e,l)}),s.addEventListener("click",function(e){e.target.getAttribute("multi-index")&&s.lists.selected.contains(e.target)&&function(e,t,r){var i=t.target.getAttribute("multi-index"),n=e.options[i];if(!n.disabled&&n.selected){e.setAttribute("data-multi-hilight",""+i);var a=e.wrapper.lists.selected.querySelectorAll(".item");if(a)for(var l=0;l<a.length;l++)a[l].classList.remove("hilight");t.target.className+=" hilight"}}(a,e)}),l.selected_updown){var p=document.createElement("div"),h=document.createElement("div"),m=document.createElement("div"),v=document.createElement("button"),f=document.createElement("button");p.className="wrapper-low",m.className="controls",h.className="controls",v.className="btn btn-up",f.className="btn btn-down",v.setAttribute("type","button"),f.setAttribute("type","button"),v.innerHTML=l.button_up_label?l.button_up_label:"↑",f.innerHTML=l.button_down_label?l.button_down_label:"↓",m.appendChild(v),m.appendChild(f),p.appendChild(h),p.appendChild(m),s.appendChild(p),v.addEventListener("click",function(e){!function(e,t,n){for(var a=e.wrapper.lists.selected.querySelectorAll(".item"),l=1;l<a.length;l++){var s=a[l];s.classList.contains("hilight")&&e.wrapper.lists.selected.insertBefore(s,a[l-1])}var d=r(e,n);i(e,n,d)}(a,0,l)}),f.addEventListener("click",function(e){!function(e,t,n){for(var a=e.wrapper.lists.selected.querySelectorAll(".item"),l=0;l<a.length-1;l++){var s=a[l];s.classList.contains("hilight")&&e.wrapper.lists.selected.insertBefore(s,a[l+1].nextSibling)}var d=r(e,n);i(e,n,d)}(a,0,l)})}for(var _=0;_<a.options.length;_++){var b=a.options[_];b.setAttribute("data-origin-disabled",b.disabled)}e(a,l),n(a,l),a.addEventListener("change",function(){n(a,l)})}}}(),multi_get_selected_order=function(e){if(e)try{var t=e.getAttribute("data-selected-order");return t?JSON.parse(t):void 0}catch(e){return[]}};"undefined"!=typeof jQuery&&function(e){e.fn.multi=function(t){if("string"!=typeof t)return settings=void 0!==t?t:{},this.each(function(){var t=e(this);multi(t.get(0),settings)});if("multi_get_selected_order"===t){var r=e(this);if(r.length>1)throw"Method call only supported on a single jQuery object.";return multi_get_selected_order(r.get(0))}}}(jQuery);